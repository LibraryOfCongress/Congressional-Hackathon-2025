<!doctype html> <html lang="en"> <head> <meta charset="utf-8" /> <title>Disbursements</title> <style> body { font-family: system-ui, sans-serif; margin: 1.5rem; } .controls { display: grid; grid-template-columns: repeat(6, minmax(150px, 1fr)); gap: 0.5rem; margin-bottom: 1rem; } table { border-collapse: collapse; width: 100%; } th, td { border: 1px solid #ddd; padding: 6px 8px; vertical-align: top; } th { background: #f6f6f6; position: sticky; top: 0; } .pager { margin-top: 0.75rem; display: flex; gap: 0.5rem; align-items: center; } .right { text-align: right; } .muted { color: #666; font-size: 0.9em; } input, select, button { padding: 6px; } </style> </head> <body> 



	<h1>Disbursements</h1> 

	<div style="margin: 1rem 0; padding: 0.75rem; border: 1px solid #ddd;"> <h2>Ask the data</h2> <div style="display:flex; gap:0.5rem; align-items:center;"> <input id="ask_q" placeholder='e.g., "Which is the largest vendor recipient of funds?"' style="flex:1; padding:6px;" /> <button id="ask_go">Ask</button> </div> <div id="ask_ans" style="white-space:pre-wrap; margin-top:0.75rem;"></div> <div id="ask_tbl_wrap" style="overflow:auto; margin-top:0.5rem;"></div> </div>



	<div class="controls"> <input id="q" placeholder="Search all (vendor, desc, org, program, doc)..." /> <select id="fiscal_year"> <option value="">Fiscal year (all)</option> </select> <select id="org"> <option value="">Organization (all)</option> </select> <input id="vendor" placeholder="Vendor contains..." /> <input id="date_from" type="date" /> <input id="date_to" type="date" /> </div> <div class="controls"> <select id="sort"> <option value="date">Sort by: Date</option> <option value="amount">Sort by: Amount</option> <option value="vendor">Sort by: Vendor</option> <option value="org">Sort by: Organization</option> <option value="program">Sort by: Program</option> </select> <select id="dir"> <option value="desc">Descending</option> <option value="asc">Ascending</option> </select> <button id="apply">Apply</button> <span class="muted">Tip: you can combine filters.</span> </div> <table id="tbl"> <thead> <tr> <th>Organization</th> <th>FiscalYear</th> <th>Program</th> <th>TransactionDate</th> <th>VendorName</th> <th>Description</th> <th class="right">Amount</th> </tr> </thead> <tbody></tbody> </table> <div class="pager"> <button id="prev">Prev</button> <button id="next">Next</button> <span id="status" class="muted"></span> </div> <script> const tbody = document.querySelector("#tbl tbody"); const statusEl = document.getElementById("status"); const fiscalYearSel = document.getElementById("fiscal_year"); const orgSel = document.getElementById("org"); const qInp = document.getElementById("q"); const vendorInp = document.getElementById("vendor"); const dateFromInp = document.getElementById("date_from"); const dateToInp = document.getElementById("date_to"); const sortSel = document.getElementById("sort"); const dirSel = document.getElementById("dir"); const limit = 25; let offset = 0; let total = 0; function fmtAmount(v) { if (v === null || v === undefined || v === "") return ""; const n = Number(v); if (Number.isFinite(n)) return n.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}); return v; } async function loadMeta() { const res = await fetch("/api/meta"); const meta = await res.json(); for (const y of meta.fiscalYears) { const opt = document.createElement("option"); opt.value = y; opt.textContent = y; fiscalYearSel.appendChild(opt); } for (const o of meta.organizations) { const opt = document.createElement("option"); opt.value = o; opt.textContent = o; orgSel.appendChild(opt); } } async function loadRows() { const params = new URLSearchParams({ limit, offset, sort: sortSel.value, dir: dirSel.value }); if (qInp.value.trim()) params.set("q", qInp.value.trim()); if (fiscalYearSel.value) params.set("fiscal_year", fiscalYearSel.value); if (orgSel.value) params.set("org", orgSel.value); if (vendorInp.value.trim()) params.set("vendor", vendorInp.value.trim()); if (dateFromInp.value) params.set("date_from", dateFromInp.value); if (dateToInp.value) params.set("date_to", dateToInp.value); const res = await fetch("/api/disbursements?" + params.toString()); const data = await res.json(); total = data.total; tbody.innerHTML = data.rows.map(r => ` <tr> <td>${r.Organization ?? ""}</td> <td>${r.FiscalYear ?? ""}</td> <td>${r.Program ?? ""}</td> <td>${r.TransactionDate ?? ""}</td> <td>${r.VendorName ?? ""}</td> <td>${r.Description ?? ""}</td> <td class="right">${fmtAmount(r.Amount)}</td> </tr> `).join(""); const start = total === 0 ? 0 : (offset + 1); const end = Math.min(offset + limit, total); statusEl.textContent = `Showing ${start}-${end} of ${total}`; document.getElementById("prev").disabled = offset === 0; document.getElementById("next").disabled = offset + limit >= total; } document.getElementById("apply").onclick = () => { offset = 0; loadRows(); }; document.getElementById("prev").onclick = () => { offset = Math.max(0, offset - limit); loadRows(); }; document.getElementById("next").onclick = () => { offset = offset + limit; loadRows(); }; // Enter-to-apply
	 for (const el of [qInp, vendorInp, dateFromInp, dateToInp]) { el.addEventListener("keydown", (e) => { if (e.key === "Enter") { offset = 0; loadRows(); }}); } loadMeta().then(loadRows); </script>

<script> async function askLLM() { const q = document.getElementById("ask_q").value.trim(); if (!q) return; const ansEl = document.getElementById("ask_ans"); const tblWrap = document.getElementById("ask_tbl_wrap"); ansEl.textContent = "Thinking..."; tblWrap.innerHTML = ""; const res = await fetch("/api/ask", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({ question: q }) }); const data = await res.json(); if (!res.ok) { ansEl.textContent = "Error: " + (data.error || res.statusText); return; } ansEl.textContent = data.answer || "(no answer)"; // Render a small result table if present
 if (Array.isArray(data.rows) && data.rows.length) { const cols = data.columns || Object.keys(data.rows[0]); const html = ` <div style="margin-top:0.5rem; font-size:0.9em; color:#666;"> SQL: <code>${(data.sql || "").replaceAll("<","&lt;")}</code> </div> <table style="border-collapse:collapse; margin-top:0.25rem;"> <thead><tr>${cols.map(c => `<th style="border:1px solid #ddd; padding:4px 6px; background:#f6f6f6;">${c}</th>`).join("")}</tr></thead> <tbody> ${data.rows.map(r => ` <tr>${cols.map(c => `<td style="border:1px solid #ddd; padding:4px 6px;">${r[c] ?? ""}</td>`).join("")}</tr> `).join("")} </tbody> </table>`; tblWrap.innerHTML = html; } } document.getElementById("ask_go").onclick = askLLM; document.getElementById("ask_q").addEventListener("keydown", e => { if (e.key === "Enter") askLLM(); }); </script>

	 </body> </html>